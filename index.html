<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="utf-8">
	<title>Pepys Coverage</title>

	<!-- Visavail.js style -->
	<link href='https://fonts.googleapis.com/css?family=Muli' rel='stylesheet' type='text/css'>
	<link href='visavail.css' rel='stylesheet' type='text/css'>
	<link href="bootstrap.min.css" rel="stylesheet" type='text/css'>
		
	<!-- font-awesome -->
	<link
		href="https://fonts.googleapis.com/css?family=Muli"
		rel="stylesheet"
		type="text/css"
	>
	<link
		rel="stylesheet"
		href="https://use.fontawesome.com/releases/v5.0.12/css/all.css"
		integrity="sha384-G0fIWCsCzJIMAVNQPfjH08cyYaUtMwjJwqiRKxxE/rx96Uroj1BtIQ6MLJuheaO9"
		crossorigin="anonymous"
	>

	<style type="text/css">
		body {
		}
		#toolbar {
			display: flex;
			flex-direction: row;
			justify-content: flex-end;
		}
		.platform-heading {
		    margin-bottom: 0;
		    text-align: center;
		    line-height: 2;
		    font-weight: bold;
		    border-radius: 0.5em;
		    background-color: #0dac50;
		    color: white;
		}
		#data-received-button {
			margin-bottom: 50px;
			margin-right: 30px;
		}
		.xAxis {
		    display: none;
		}
		.chart-row {
		    justify-content: space-between;
		}
		.visavail .rect_has_no_data {
		    fill: lightgray;
		}
		.visavail .rect_has_no_data:hover {
		    fill: silver;
		}
		#visavail_graph > svg > g {
		    transform: translate(100px, 10%);
		}
		.heading {
		    border: 1px solid gray;
		}
	</style>

</head>

<body>
	<div class="container">
        <div class="row">
            <div class="col-md-12">
                <h1>Pepys Coverage</h1>
            </div>
        </div>
        <div class="row">
            <div class="col-md-12">
                <div id="toolbar">
                    <button
                        type="button"
                        class="btn btn-success"
                        id="data-received-button"
                        onclick="onDataReceived()"
                     >
                    Data Received
                 </button>
                </div>
            </div>
        </div>
        <div class="row chart-row">
            <div class="col-sm-12 col-md-3">
                <h5 class="platform-heading">J05130 - CASEX 324</h5>
                <div style="overflow: hidden;" class="visavail" id="visavail_container">
                    <p id="visavail_graph">
                    </p>
                </div>
            </div>
            <div class="col-sm-12 col-md-3">
                <div style="overflow: hidden;" class="visavail" id="visavail_container_2">
                    <p id="visavail_graph_2">
                        placeholder chart 2
                    </p>
                </div>
            </div>
            <div class="col-sm-12 col-md-3">
                <div style="overflow: hidden;" class="visavail" id="visavail_container_3">
                    <p id="visavail_graph_3">
                        placeholder chart 3
                    </p>
                </div>
            </div>
            <div class="col-sm-12 col-md-3">
                <div style="overflow: hidden;" class="visavail" id="visavail_container_4">
                    <p id="visavail_graph_4">
                        placeholder chart 4
                    </p>
                </div>
            </div>
        </div>
        <div class="row chart-row">
            <div class="col-sm-12 col-md-3">
                <div style="overflow: hidden;" class="visavail" id="visavail_container_5">
                    <p id="visavail_graph_5">
                        placeholder chart 5
                    </p>
                </div>
            </div>
        </div>
	</div>
	<script src="moment-with-locales.min.js" type="text/javascript"></script>

	<script src="d3.min.js" ></script>
	<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/4.13.0/d3.js"></script> -->

	<script src="visavail.js"></script>
	<!-- <script src="../visavail/js/visavail.min.js"></script> -->

	<script type="text/javascript">
		moment.locale("en");

		function onDataReceived() {
			console.log('on data received');
		}

		var commonDate = new Date("01/01/2020");
		var stripDateOfChars = date => date.toISOString().slice(0,-5).replace('T', ' ');

		var rawData = [
			{
				"serial": "J05130 - CASEX 324",
				"start_time": 1000,
				"end_time": 1200,
				"participants": [
					{
						"name": "RICH",
						"coverage": [
							[1000, 1040],
							[1050, 1105],
							[1130, 1200],
						]
					},
					{
						"name": "DUKE",
						"coverage": [
							[1015, 1030],
							[1035, 1100],
							[1140, 1200],
						]
					},
					{
						"name": "CUMB",
						"coverage": [
							[1000, 1005],
							[1045, 1100],
							[1145, 1200],
						]
					}
				]
			}
		];

		const periodStart = rawData[0].start_time.toString();
		const periodEnd = rawData[0].end_time.toString();
		const periodStartHours = periodStart.substring(0, 2);
		const periodStartMinutes = periodStart.substring(2, 4);
		const periodEndHours = periodEnd.substring(0, 2);
		const periodEndMinutes = periodEnd.substring(2, 4);

		var transformedData = rawData[0].participants.map(participant => {
			return {
				"measure": participant.name,
				"data": [
					[
						stripDateOfChars(new Date(
							commonDate.getFullYear(),
							commonDate.getMonth(),
							commonDate.getDate(),
							periodStartHours,
							periodStartMinutes,
							0
						)),
						0,
						stripDateOfChars(new Date(
							commonDate.getFullYear(),
							commonDate.getMonth(),
							commonDate.getDate(),
							periodEndHours,
							periodEndMinutes,
							0
						)),
					]
				].concat(participant.coverage.map(cov => {
					var [start, end] = cov;
					start = start.toString();
					end = end.toString();
					const startHours = start.substring(0, 2);
					const startMinutes = start.substring(2, 4);
					const endHours = end.substring(0, 2);
					const endMinutes = end.substring(2, 4);

					const startDatetime = new Date(
						commonDate.getFullYear(),
						commonDate.getMonth(),
						commonDate.getDate(),
						startHours,
						startMinutes,
						0
					);
					const endDatetime = new Date(
						commonDate.getFullYear(),
						commonDate.getMonth(),
						commonDate.getDate(),
						endHours,
						endMinutes,
						0
					);
					const res = [
						stripDateOfChars(startDatetime),
						1,
						stripDateOfChars(endDatetime),
					];
					return res;
				}))
			}
		});

		var options = {
			id_div_container: "visavail_container",
			id_div_graph: "visavail_graph",

			title: {
			    enabled: false,
				text: rawData[0].serial,
			},
			sub_title: {
			    enabled: false,
			},
			icon: {
				class_has_data: 'fas fa-fw fa-check',
				class_has_no_data: 'fas fa-fw fa-exclamation-circle'
			},
			legend: {
			    enabled: false,
				has_data_text: 'Coverage available',
				has_no_data_text: 'Coverage unavailable',
			},
			responsive: {
				enabled: true,
			},
            line_spacing: 8,
		};
		
		var chart = visavail.generate(options, transformedData);

	</script>

</body>

</html>
